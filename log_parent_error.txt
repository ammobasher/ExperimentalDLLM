Flax classes are deprecated and will be removed in Diffusers v1.0.0. We recommend migrating to PyTorch classes or pinning your version of Diffusers.
Flax classes are deprecated and will be removed in Diffusers v1.0.0. We recommend migrating to PyTorch classes or pinning your version of Diffusers.
Flax classes are deprecated and will be removed in Diffusers v1.0.0. We recommend migrating to PyTorch classes or pinning your version of Diffusers.
Flax classes are deprecated and will be removed in Diffusers v1.0.0. We recommend migrating to PyTorch classes or pinning your version of Diffusers.
Flax classes are deprecated and will be removed in Diffusers v1.0.0. We recommend migrating to PyTorch classes or pinning your version of Diffusers.
Traceback (most recent call last):
  File "/Users/ahmed/Documents/ExperimentalDLLM/src/world_model.py", line 33, in __init__
    self.vae, self.vae_params = FlaxAutoencoderKL.from_pretrained(
                                ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        model_id,
        ^^^^^^^^^
        subfolder="vae",
        ^^^^^^^^^^^^^^^^
        revision="flax"
        ^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/ahmed/Documents/ExperimentalDLLM/venv/lib/python3.14/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
  File "/Users/ahmed/Documents/ExperimentalDLLM/venv/lib/python3.14/site-packages/diffusers/models/modeling_flax_utils.py", line 443, in from_pretrained
    params_shape_tree = jax.eval_shape(model.init_weights, rng=jax.random.PRNGKey(0))
  File "/Users/ahmed/Documents/ExperimentalDLLM/venv/lib/python3.14/site-packages/diffusers/models/vae_flax.py", line 887, in init_weights
    return self.init(rngs, sample)["params"]
           ~~~~~~~~~^^^^^^^^^^^^^^
  File "/Users/ahmed/Documents/ExperimentalDLLM/venv/lib/python3.14/site-packages/diffusers/models/vae_flax.py", line 916, in __call__
    posterior = self.encode(sample, deterministic=deterministic, return_dict=return_dict)
  File "/Users/ahmed/Documents/ExperimentalDLLM/venv/lib/python3.14/site-packages/diffusers/models/vae_flax.py", line 892, in encode
    hidden_states = self.encoder(sample, deterministic=deterministic)
  File "/Users/ahmed/Documents/ExperimentalDLLM/venv/lib/python3.14/site-packages/diffusers/models/vae_flax.py", line 603, in __call__
    sample = block(sample, deterministic=deterministic)
  File "/Users/ahmed/Documents/ExperimentalDLLM/venv/lib/python3.14/site-packages/diffusers/models/vae_flax.py", line 351, in __call__
    hidden_states = resnet(hidden_states, deterministic=deterministic)
  File "/Users/ahmed/Documents/ExperimentalDLLM/venv/lib/python3.14/site-packages/diffusers/models/vae_flax.py", line 181, in setup
    self.dropout_layer = nn.Dropout(self.dropout)
                         ~~~~~~~~~~^^^^^^^^^^^^^^
  File "/Users/ahmed/Documents/ExperimentalDLLM/venv/lib/python3.14/site-packages/flax/linen/kw_only_dataclasses.py", line 274, in init_wrapper
    dataclass_init(self, *args, **kwargs)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 8, in __init__
ValueError: parent must be None, Module or Scope
--------------------
For simplicity, JAX has removed its internal frames from the traceback of the following exception. Set JAX_TRACEBACK_FILTERING=off to include these.
DEBUG: _Conv annotations: ['parent', 'name', 'strides', 'padding', 'input_dilation', 'kernel_dilation', 'feature_group_count', 'use_bias', 'mask', 'dtype', 'precision', 'conv_general_dilated', 'conv_general_dilated_cls', 'shared_weights']
DEBUG: Conv annotations: ['parent', 'name', 'shared_weights']
DEBUG: FlaxDownEncoderBlock2D annotations keys: ['parent', 'name', 'dropout', 'num_layers', 'resnet_groups', 'add_downsample']
Initializing Visual Cortex...
Loading Visual Cortex (VAE) from CompVis/stable-diffusion-v1-4...
JAX_DEBUG: init called. key_type=<class 'jax._src.interpreters.partial_eval.DynamicJaxprTracer'>, shape_type=<class 'tuple'>, shape=(3, 3, 3, 128)
Traceback (most recent call last):
  File "/Users/ahmed/Documents/ExperimentalDLLM/src/world_model.py", line 33, in __init__
    self.vae, self.vae_params = FlaxAutoencoderKL.from_pretrained(
                                ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        model_id,
        ^^^^^^^^^
        subfolder="vae",
        ^^^^^^^^^^^^^^^^
        revision="flax"
        ^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/ahmed/Documents/ExperimentalDLLM/venv/lib/python3.14/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
  File "/Users/ahmed/Documents/ExperimentalDLLM/venv/lib/python3.14/site-packages/diffusers/models/modeling_flax_utils.py", line 443, in from_pretrained
    params_shape_tree = jax.eval_shape(model.init_weights, rng=jax.random.PRNGKey(0))
  File "/Users/ahmed/Documents/ExperimentalDLLM/venv/lib/python3.14/site-packages/diffusers/models/vae_flax.py", line 887, in init_weights
    return self.init(rngs, sample)["params"]
           ~~~~~~~~~^^^^^^^^^^^^^^
  File "/Users/ahmed/Documents/ExperimentalDLLM/venv/lib/python3.14/site-packages/diffusers/models/vae_flax.py", line 916, in __call__
    posterior = self.encode(sample, deterministic=deterministic, return_dict=return_dict)
  File "/Users/ahmed/Documents/ExperimentalDLLM/venv/lib/python3.14/site-packages/diffusers/models/vae_flax.py", line 892, in encode
    hidden_states = self.encoder(sample, deterministic=deterministic)
  File "/Users/ahmed/Documents/ExperimentalDLLM/venv/lib/python3.14/site-packages/diffusers/models/vae_flax.py", line 603, in __call__
    sample = block(sample, deterministic=deterministic)
  File "/Users/ahmed/Documents/ExperimentalDLLM/venv/lib/python3.14/site-packages/diffusers/models/vae_flax.py", line 351, in __call__
    hidden_states = resnet(hidden_states, deterministic=deterministic)
  File "/Users/ahmed/Documents/ExperimentalDLLM/venv/lib/python3.14/site-packages/diffusers/models/vae_flax.py", line 181, in setup
    self.dropout_layer = nn.Dropout(self.dropout)
                         ~~~~~~~~~~^^^^^^^^^^^^^^
  File "/Users/ahmed/Documents/ExperimentalDLLM/venv/lib/python3.14/site-packages/flax/linen/kw_only_dataclasses.py", line 274, in init_wrapper
    dataclass_init(self, *args, **kwargs)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 8, in __init__
ValueError: parent must be None, Module or Scope
--------------------
For simplicity, JAX has removed its internal frames from the traceback of the following exception. Set JAX_TRACEBACK_FILTERING=off to include these.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/ahmed/Documents/ExperimentalDLLM/src/generate_visual.py", line 67, in <module>
    main()
    ~~~~^^
  File "/Users/ahmed/Documents/ExperimentalDLLM/src/generate_visual.py", line 11, in main
    world_model = LatentWorldModel(key)
  File "/Users/ahmed/Documents/ExperimentalDLLM/venv/lib/python3.14/site-packages/equinox/_module/_module.py", line 414, in __call__
    self = super().__call__(*args, **kwargs)  # pyright: ignore[reportAttributeAccessIssue]
  File "/Users/ahmed/Documents/ExperimentalDLLM/venv/lib/python3.14/site-packages/equinox/_module/_better_abstract.py", line 233, in __call__
    self = super().__call__(*args, **kwargs)
  File "/Users/ahmed/Documents/ExperimentalDLLM/src/world_model.py", line 44, in __init__
    raise RuntimeError(f"Failed to activate Visual Cortex: {e}")
RuntimeError: Failed to activate Visual Cortex: parent must be None, Module or Scope
